% Function to calculate nutation parameters using the IAU1980 nutation
% model. See: https://www.iers.org/SharedDocs/Publikationen/EN/IERS/Pub...
% lications/tn/TechnNote03/tn03_04.pdf?__blob=publicationFile&v=1
% 
% Author: Griffin Jourda 3/16/2023
% 
% Inputs
%	jd		:	TT Julian date
%
% Outputs
%	N		:	nutaiton rotation matrix

function [eps, dpsi, deps] = nutationIAU1980(jd)
	nutationData = [0 0 0 0 1 -6798.4 -171996 -174.2 92025 8.9;
				0 0 2 -2 2 182.6 -13187 -1.6 5736 -3.1;
				0 0 2 0 2 13.7 -2274 -0.2 977 -0.5;
				0 0 0 0 2 -3399.2 2062 0.2 -895 0.5;
				0 -1 0 0 0 -365.3 -1426 3.4 54 -0.1;
				1 0 0 0 0 27.6 712 0.1 -7 0.0;
				0 1 2 -2 2 121.7 -517 1.2 224 -0.6;
				0 0 2 0 1 13.6 -386 -0.4 200 0.0;
				1 0 2 0 2 9.1 -301 0.0 129 -0.1;
				0 -1 2 -2 2 365.2 217 -0.5 -95 0.3;
				-1 0 0 2 0 31.8 158 0.0 -1 0.0;
				0 0 2 -2 1 177.8 129 0.1 -70 0.0;
				-1 0 2 0 2 27.1 123 0.0 -53 0.0;
				1 0 0 0 1 27.7 63 0.1 -33 0.0;
				0 0 0 2 0 14.8 63 0.0 -2 0.0;
				-1 0 2 2 2 9.6 -59 0.0 26 0.0;
				-1 0 0 0 1 -27.4 -58 -0.1 32 0.0;
				1 0 2 0 1 9.1 -51 0.0 27 0.0;
				-2 0 0 2 0 -205.9 -48 0.0 1 0.0;
				-2 0 2 0 1 1305.5 46 0.0 -24 0.0;
				0 0 2 2 2 7.1 -38 0.0 16 0.0;
				2 0 2 0 2 6.9 -31 0.0 13 0.0;
				2 0 0 0 0 13.8 29 0.0 -1 0.0;
				1 0 2 -2 2 23.9 29 0.0 -12 0.0;
				0 0 2 0 0 13.6 26 0.0 -1 0.0;
				0 0 2 -2 0 173.3 -22 0.0 0 0.0;
				-1 0 2 0 1 27.0 21 0.0 -10 0.0;
				0 2 0 0 0 182.6 17 -0.1 0 0.0;
				0 2 2 -2 2 91.3 -16 0.1 7 0.0;
				-1 0 0 2 1 32.0 16 0.0 -8 0.0;
				0 1 0 0 1 386.0 -15 0.0 9 0.0;
				1 0 0 -2 1 -31.7 -13 0.0 7 0.0;
				0 -1 0 0 1 -346.6 -12 0.0 6 0.0;
				2 0 -2 0 0 -1095.2 11 0.0 0 0.0;
				-1 0 2 2 1 9.5 -10 0.0 5 0.0;
				1 0 2 2 2 5.6 -8 0.0 3 0.0;
				0 -1 2 0 2 14.2 -7 0.0 3 0.0;
				0 0 2 2 1 7.1 -7 0.0 3 0.0;
				1 1 0 -2 0 -34.8 -7 0.0 0 0.0;
				0 1 2 0 2 13.2 7 0.0 -3 0.0;
				-2 0 0 2 1 -199.8 -6 0.0 3 0.0;
				0 0 0 2 1 14.8 -6 0.0 3 0.0;
				2 0 2 -2 2 12.8 6 0.0 -3 0.0;
				1 0 0 2 0 9.6 6 0.0 0 0.0;
				1 0 2 -2 1 23.9 6 0.0 -3 0.0;
				0 0 0 -2 1 -14.7 -5 0.0 3 0.0;
				0 -1 2 -2 1 346.6 -5 0.0 3 0.0;
				2 0 2 0 1 6.9 -5 0.0 3 0.0;
				1 -1 0 0 0 29.8 5 0.0 0 0.0;
				1 0 0 -1 0 411.8 -4 0.0 0 0.0;
				0 0 0 1 0 29.5 -4 0.0 0 0.0;
				0 1 0 -2 0 -15.4 -4 0.0 0 0.0;
				1 0 -2 0 0 -26.9 4 0.0 0 0.0;
				2 0 0 -2 1 212.3 4 0.0 -2 0.0;
				0 1 2 -2 1 119.6 4 0.0 -2 0.0;
				1 1 0 0 0 25.6 -3 0.0 0 0.0;
				1 -1 0 -1 0 -3232.9 -3 0.0 0 0.0;
				-1 -1 2 2 2 9.8 -3 0.0 1 0.0;
				0 -1 2 2 2 7.2 -3 0.0 1 0.0;
				1 -1 2 0 2 9.4 -3 0.0 1 0.0;
				3 0 2 0 2 5.5 -3 0.0 1 0.0;
				-2 0 2 0 2 1615.7 -3 0.0 1 0.0;
				1 0 2 0 0 9.1 3 0.0 0 0.0;
				-1 0 2 4 2 5.8 -2 0.0 1 0.0;
				1 0 0 0 2 27.8 -2 0.0 1 0.0;
				-1 0 2 -2 1 -32.6 -2 0.0 1 0.0;
				0 -2 2 -2 1 6786.3 -2 0.0 1 0.0;
				-2 0 0 0 1 -13.7 -2 0.0 1 0.0;
				2 0 0 0 1 13.8 2 0.0 -1 0.0;
				3 0 0 0 0 9.2 2 0.0 0 0.0;
				1 1 2 0 2 8.9 2 0.0 -1 0.0;
				0 0 2 1 2 9.3 2 0.0 -1 0.0;
				1 0 0 2 1 9.6 -1 0.0 0 0.0;
				1 0 2 2 1 5.6 -1 0.0 1 0.0;
				1 1 0 -2 1 -34.7 -1 0.0 0 0.0;
				0 1 0 2 0 14.2 -1 0.0 0 0.0;
				0 1 2 -2 0 117.5 -1 0.0 0 0.0;
				0 1 -2 2 0 -329.8 -1 0.0 0 0.0;
				1 0 -2 2 0 23.8 -1 0.0 0 0.0;
				1 0 -2 -2 0 -9.5 -1 0.0 0 0.0;
				1 0 2 -2 0 32.8 -1 0.0 0 0.0;
				1 0 0 -4 0 -10.1 -1 0.0 0 0.0;
				2 0 0 -4 0 -15.9 -1 0.0 0 0.0;
				0 0 2 4 2 4.8 -1 0.0 0 0.0;
				0 0 2 -1 2 25.4 -1 0.0 0 0.0;
				-2 0 2 4 2 7.3 -1 0.0 1 0.0;
				2 0 2 2 2 4.7 -1 0.0 0 0.0;
				0 -1 2 0 1 14.2 -1 0.0 0 0.0;
				0 0 -2 0 1 -13.6 -1 0.0 0 0.0;
				0 0 4 -2 2 12.7 1 0.0 0 0.0;
				0 1 0 0 2 409.2 1 0.0 0 0.0;
				1 1 2 -2 2 22.5 1 0.0 -1 0.0;
				3 0 2 -2 2 8.7 1 0.0 0 0.0;
				-2 0 2 2 2 14.6 1 0.0 -1 0.0;
				-1 0 0 0 2 -27.3 1 0.0 -1 0.0;
				0 0 -2 2 1 -169.0 1 0.0 0 0.0;
				0 1 2 0 1 13.1 1 0.0 0 0.0;
				-1 0 4 0 2 9.1 1 0.0 0 0.0;
				2 1 0 -2 0 131.7 1 0.0 0 0.0;
				2 0 0 2 0 7.1 1 0.0 0 0.0;
				2 0 2 -2 1 12.8 1 0.0 -1 0.0;
				2 0 -2 0 1 -943.2 1 0.0 0 0.0;
				1 -1 0 -2 0 -29.3 1 0.0 0 0.0;
				-1 0 0 1 1 -388.3 1 0.0 0 0.0;
				-1 -1 0 2 1 35.0 1 0.0 0 0.0;
				0 1 0 1 0 27.3 1 0.0 0 0.0];
	
	T = (jd - 2451545)/36525;

	T2 = T^2; 
	T3 = T^3;
	
	% Mean obliquity 
	eps = 23.43929111 - (46.8150/3600)*T - (0.00059/3600)*T^2 + (0.001813/3600)*T^3;
	eps = eps*pi/180;

	% Fundamental arugments
	l = (134 + 57/60 + 46.733/3600) + (477198 + 52/60 + 2.633/3600)*T + (31.310/3600)*T2 + (0.064/3600)*T3; 
	lp = (357 + 31/60 + 39.804/3600) + (35999 + 3/60 + 1.224/3600)*T - (0.577/3600)*T2 - (0.012/3600)*T3; 
	F = (93 + 16/60 + 18.877/3600) + (483202 + 1/60 + 3.137/3600)*T - (13.257/3600)*T2 + (0.011/3600)*T3; 
	D = (297 + 51/60 + 1.307/3600) + (445267 + 6/60 + 41.328/3600)*T - (6.891/3600)*T2 + (0.019/3600)*T3; 
	W = (125 + 2/60 + 40.280/3600) - (1934 + 8/60 + 10.539/3600)*T + (7.455/3600)*T2 + (0.008/3600)*T3;
	
	l = l*pi/180;
	lp = lp*pi/180; 
	F = F*pi/180; 
	D = D*pi/180; 
	W = W*pi/180;

	% Nutation summation
	dpsi = 0; 
	deps = 0;

	for i = 1:106
		pl = nutationData(i, 1);
		plp = nutationData(i, 2); 
		pF = nutationData(i, 3);
		pD = nutationData(i, 4);
		pW = nutationData(i, 5);

		dpsi_i = (nutationData(i, 7) + nutationData(i, 8)*T)*(0.0001/3600)*(pi/180);
		deps_i = (nutationData(i, 9) + nutationData(i, 10)*T)*(0.0001/3600)*(pi/180);
		phi_i = pl*l + plp*lp + pF*F + pD*D + pW*W;

		dpsi = dpsi + dpsi_i*sin(phi_i);
		deps = deps + deps_i*cos(phi_i);
	end
end